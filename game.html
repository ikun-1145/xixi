<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>霜蓝小游戏</title>
<link href="https://fonts.googleapis.com/css2?family=Product+Sans&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Product Sans', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    background: linear-gradient(135deg,#e0faff,#ffffff), url('p/bg.png') center center / cover no-repeat fixed;
  }
  canvas { background: #87ceeb; display: block; }

  #buttonsContainer {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    flex-direction: column;
    gap: 1rem;
    align-items: center;
  }

  #buttonsContainer button,
  #buttonsContainer a {
    display: inline-block;
    padding: 0.8rem 1.5rem;
    background: linear-gradient(to right, #71f8fc, #a0fff8);
    border-radius: 30px;
    text-decoration: none;
    color: black;
    font-weight: bold;
    font-size: 1.1rem;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    text-align: center;
    cursor: pointer;
  }

  #buttonsContainer button:hover,
  #buttonsContainer a:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
  }

  #gameOverOverlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 2rem;
    font-weight: bold;
    z-index: 2;
  }
</style>
</head>
<body>

<div style="position: relative;">
  <canvas id="gameCanvas" width="400" height="600"></canvas>

  <div id="gameOverOverlay">游戏结束</div>

  <div id="buttonsContainer">
    <button id="restartBtn">重新开始</button>
    <a href="index.html">返回主页</a>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const blockImg = new Image();
blockImg.src = 'p/block.png'; // 替换为你的小方块图片

let gameOver = false;
let y = canvas.height/2;
let velocity = 0;
const gravity = 0.35; // 下落速度适中
const jump = -7; // 上升高度适中

// 管子设置
let pipes = [];
const pipeWidth = 50;
const pipeGap = 180; // 管子上下间距
const pipeDistance = 300; // 前后间距

let frameCount = 0;

function resetGame(){
  gameOver = false;
  y = canvas.height/2;
  velocity = 0;
  pipes = [];
  frameCount = 0;
  buttonsContainer.style.display = 'none';
  gameOverOverlay.style.display = 'none';
  requestAnimationFrame(gameLoop);
}

// 监听点击
canvas.addEventListener('click', () => {
  if(!gameOver) velocity = jump;
});

// 生成管子
function generatePipe(){
  const topHeight = Math.random() * (canvas.height - pipeGap - 100) + 50;
  pipes.push({ x: canvas.width, top: topHeight, bottom: topHeight + pipeGap });
}

// 游戏结束按钮
const buttonsContainer = document.getElementById('buttonsContainer');
const restartBtn = document.getElementById('restartBtn');
const gameOverOverlay = document.getElementById('gameOverOverlay');

restartBtn.addEventListener('click', resetGame);

// 主循环
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // 更新
  velocity += gravity;
  y += velocity;

  frameCount++;
  if(frameCount % pipeDistance === 0) generatePipe();

  // 绘制管子
  for(let i=pipes.length-1;i>=0;i--){
    let p = pipes[i];
    p.x -= 2;
    ctx.fillStyle = 'green';
    ctx.fillRect(p.x,0,pipeWidth,p.top);
    ctx.fillRect(p.x,p.bottom,pipeWidth,canvas.height-p.bottom);

    // 碰撞检测
    if(blockImg.width/2 + 20 > p.x && y < p.top || y + 20 > p.bottom && blockImg.width/2 + 20 > p.x){
      endGame();
    }

    // 移除离开屏幕的管子
    if(p.x + pipeWidth < 0) pipes.splice(i,1);
  }

  // 绘制小方块
  ctx.drawImage(blockImg, 50, y, 40, 40);

  // 超出画布下边界
  if(y + 40 > canvas.height || y < 0) endGame();

  if(!gameOver) requestAnimationFrame(gameLoop);
}

function endGame(){
  gameOver = true;
  gameOverOverlay.style.display = 'flex';
  buttonsContainer.style.display = 'flex';
}

// 开始游戏
requestAnimationFrame(gameLoop);
</script>

</body>
</html>