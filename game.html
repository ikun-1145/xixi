<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>小游戏</title>
  <style>
    body { margin: 0; overflow: hidden; background: #71f8fc; }
    canvas { display: block; margin: auto; background: url('p/bg.png') center / cover no-repeat; }
    #restartBtn {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      padding: 12px 24px; font-size: 20px; border: none;
      border-radius: 12px; background: #a0fff8; cursor: pointer;
      display: none;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<button id="restartBtn">重新开始</button>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 400;
canvas.height = 600;

// 小鸟
let bird = { x: 50, y: 250, w: 30, h: 30, gravity: 0.6, vel: 0 };

// 管子数组
let pipes = [];
let score = 0;
let gameOver = false;

// 按钮
const restartBtn = document.getElementById('restartBtn');

// 生成管子
function spawnPipe() {
  let top = Math.random() * 200 + 50; // 上管子高度
  let gap = 180; // 增大间隙
  pipes.push({ x: canvas.width, w: 50, top: top, bottom: canvas.height - top - gap, passed: false });
}

// 重置游戏
function resetGame() {
  bird.y = 250;
  bird.vel = 0;
  pipes = [];
  score = 0;
  gameOver = false;
  restartBtn.style.display = 'none';
  loop();
}

// 控制：空格键或鼠标点击
document.addEventListener('keydown', e => { if(e.code === 'Space') bird.vel = -6; }); // lift 减小
document.addEventListener('mousedown', () => { bird.vel = -6; });

// 更新逻辑
function update() {
  bird.vel += bird.gravity;
  bird.y += bird.vel;

  if (bird.y + bird.h > canvas.height || bird.y < 0) gameOver = true;

  if (pipes.length === 0 || pipes[pipes.length-1].x < 350) spawnPipe(); // 管子间距增加

  pipes.forEach(pipe => {
    pipe.x -= 2;
    if (!pipe.passed && bird.x > pipe.x + pipe.w) {
      score++;
      pipe.passed = true;
    }
    if (bird.x < pipe.x + pipe.w && bird.x + bird.w > pipe.x &&
        (bird.y < pipe.top || bird.y + bird.h > canvas.height - pipe.bottom)) {
      gameOver = true;
    }
  });

  pipes = pipes.filter(p => p.x + p.w > 0);
}

// 绘制
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 小鸟
  ctx.fillStyle = 'blue';
  ctx.fillRect(bird.x, bird.y, bird.w, bird.h);

  // 管子
  ctx.fillStyle = 'green';
  pipes.forEach(pipe => {
    ctx.fillRect(pipe.x, 0, pipe.w, pipe.top);
    ctx.fillRect(pipe.x, canvas.height - pipe.bottom, pipe.w, pipe.bottom);
  });

  // 分数
  ctx.fillStyle = 'white';
  ctx.font = '24px Arial';
  ctx.fillText('得分: '+score, 10, 30);
}

// 游戏循环
function loop() {
  if(gameOver){
    restartBtn.style.display = 'block';
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = 'white';
    ctx.font = '36px Arial';
    ctx.fillText('游戏结束', 100, 300);
    ctx.fillText('得分: '+score, 120, 350);
    return;
  }
  update();
  draw();
  requestAnimationFrame(loop);
}

// 重玩按钮
restartBtn.addEventListener('click', resetGame);

loop();
</script>
</body>
</html>