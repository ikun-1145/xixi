<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>像素风小游戏 - 霜蓝的个人主页</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  body {
    background: #71c7ec;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    font-family: 'Press Start 2P', cursive;
    margin: 0;
    padding: 0;
  }
  h1 {
    margin: 1rem 0;
    color: #fff;
    text-shadow: 2px 2px #000;
  }
  canvas {
    image-rendering: pixelated; /* 放大像素风 */
    border: 4px solid #000;
    display: block;
    margin: 0 auto;
  }
  .buttons {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  .buttons button, .buttons a {
    padding: 0.6rem 1.2rem;
    background: #ffea00;
    color: #000;
    border-radius: 4px;
    border: 2px solid #000;
    font-family: 'Press Start 2P', cursive;
    cursor: pointer;
    text-decoration: none;
    text-align: center;
  }
  .buttons button:hover, .buttons a:hover {
    background: #ffd700;
  }
</style>
</head>
<body>
<h1>像素风小游戏</h1>
<canvas id="gameCanvas" width="400" height="600"></canvas>

<div class="buttons" id="buttonsContainer">
  <button id="restartBtn">重新开始</button>
  <a href="index.html">返回主页</a>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const buttonsContainer = document.getElementById('buttonsContainer');

let player = { x: 50, y: 250, size: 20, dy: 0 };
let gravity = 0.5;
let jump = -8;
let pipes = [];
let pipeWidth = 40;
let pipeGap = 150;
let pipeSpacing = 200;
let frame = 0;
let score = 0;
let gameOver = false;
let animationId;

function resetGame(){
  player.y = 250;
  player.dy = 0;
  pipes = [];
  frame = 0;
  score = 0;
  gameOver = false;
  buttonsContainer.style.display = 'none';
  cancelAnimationFrame(animationId);
  animate();
}

function createPipe(){
  let topHeight = Math.floor(Math.random() * (canvas.height - pipeGap - 50)) + 25;
  pipes.push({ x: canvas.width, topHeight, passed: false });
}

function draw(){
  // 背景
  ctx.fillStyle = '#71c7ec';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // 管子
  ctx.fillStyle = '#2b7a78';
  for(let pipe of pipes){
    ctx.fillRect(pipe.x, 0, pipeWidth, pipe.topHeight);
    ctx.fillRect(pipe.x, pipe.topHeight + pipeGap, pipeWidth, canvas.height - (pipe.topHeight + pipeGap));
  }

  // 玩家
  ctx.fillStyle = '#ffcc00';
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // 分数
  ctx.fillStyle = '#000';
  ctx.font = '20px "Press Start 2P"';
  ctx.fillText(`分数: ${score}`, 10, 30);

  // 游戏结束
  if(gameOver){
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#fff';
    ctx.font = '30px "Press Start 2P"';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('游戏结束', canvas.width/2, canvas.height/2);
  }
}

function update(){
  if(gameOver) return;
  player.dy += gravity;
  player.y += player.dy;

  if(frame % pipeSpacing === 0) createPipe();

  for(let pipe of pipes) pipe.x -= 2;
  pipes = pipes.filter(pipe => pipe.x + pipeWidth > 0);

  for(let pipe of pipes){
    if(player.x + player.size > pipe.x && player.x < pipe.x + pipeWidth){
      if(player.y < pipe.topHeight || player.y + player.size > pipe.topHeight + pipeGap){
        endGame();
      }
    }
    if(!pipe.passed && player.x > pipe.x + pipeWidth){
      score++;
      pipe.passed = true;
    }
  }

  if(player.y + player.size > canvas.height || player.y < 0) endGame();
  frame++;
}

function animate(){
  update();
  draw();
  if(!gameOver) animationId = requestAnimationFrame(animate);
  else buttonsContainer.style.display = 'flex';
}

function endGame(){
  gameOver = true;
  draw();
}

document.addEventListener('keydown', e => { if(e.code === 'Space' && !gameOver) player.dy = jump; });
document.addEventListener('click', () => { if(!gameOver) player.dy = jump; });
document.getElementById('restartBtn').addEventListener('click', resetGame);

resetGame();
</script>
</body>
</html>