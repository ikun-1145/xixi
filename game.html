<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>霜蓝的小游戏</title>
<link href="https://fonts.googleapis.com/css2?family=Product+Sans&display=swap" rel="stylesheet">
<style>
  body {
    margin:0; padding:0;
    font-family: 'Product Sans', sans-serif;
    background: linear-gradient(135deg, #e0faff, #ffffff);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    color:#1A1A1A;
  }

  #gameContainer {
    position: relative;
    width: 360px;
    max-width: 90vw;
    aspect-ratio: 9/16;
    background: #71f8fc;
    border-radius: 16px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  canvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  #score {
    position: absolute;
    top:10px;
    font-size:1.5rem;
    font-weight:bold;
    color:#fff;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
  }

  #buttonsContainer {
    display: none;
    position: absolute;
    bottom: 10px;
    width: 100%;
    display: flex;
    justify-content: space-around;
    gap:10px;
    padding:0 10px;
  }

  .game-button {
    padding:0.8rem 1.5rem;
    background: linear-gradient(to right, #71f8fc, #a0fff8);
    border-radius: 30px;
    color:black;
    font-weight:bold;
    font-size:1.1rem;
    text-decoration:none;
    border:none;
    cursor:pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .game-button:hover {
    transform: translateY(-3px);
    box-shadow:0 6px 12px rgba(0,0,0,0.15);
  }

  @media (max-width:480px){
    #gameContainer { width: 90vw; aspect-ratio: 9/16; }
    .game-button { font-size:1rem; padding:0.6rem 1rem; }
  }
</style>
</head>
<body>
<div id="gameContainer">
  <canvas id="gameCanvas"></canvas>
  <div id="score">0</div>
  <div id="buttonsContainer">
    <button id="restartBtn" class="game-button">重新开始</button>
    <a href="index.html" class="game-button">返回主页</a>
  </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let width = canvas.width = 360;
let height = canvas.height = 640;

let player = { x:50, y:height/2, size:30, vy:0 };
let gravity = 0.3;
let jumpPower = -6;
let pipes = [];
let pipeWidth = 50;
let pipeGap = 150;
let pipeSpacing = 250;
let score = 0;
let gameOver = false;

// 初始化管子
function initPipes(){
  pipes = [];
  for(let i=0;i<3;i++){
    let topHeight = Math.random() * (height - pipeGap - 100) + 50;
    pipes.push({ x: width + i*pipeSpacing, topHeight });
  }
}

// 点击上升
canvas.addEventListener('click',()=>{
  if(!gameOver){
    player.vy = jumpPower;
  }
});

// 游戏循环
function update(){
  if(gameOver) return;

  player.vy += gravity;
  player.y += player.vy;

  pipes.forEach(pipe=>{
    pipe.x -= 2;
    // 碰撞检测
    if(player.x + player.size > pipe.x && player.x < pipe.x + pipeWidth){
      if(player.y < pipe.topHeight || player.y + player.size > pipe.topHeight + pipeGap){
        endGame();
      }
    }
    // 经过管子计分
    if(pipe.x + pipeWidth === player.x){
      score++;
      document.getElementById('score').textContent = score;
    }
  });

  // 移除左侧管子并生成新管子
  if(pipes[0].x + pipeWidth < 0){
    pipes.shift();
    let topHeight = Math.random() * (height - pipeGap - 100) + 50;
    pipes.push({ x: pipes[pipes.length-1].x + pipeSpacing, topHeight });
  }

  // 撞到地面或上方
  if(player.y + player.size > height || player.y < 0){
    endGame();
  }
}

function draw(){
  ctx.clearRect(0,0,width,height);

  // 绘制管子
  ctx.fillStyle = '#4caf50';
  pipes.forEach(pipe=>{
    ctx.fillRect(pipe.x,0,pipeWidth,pipe.topHeight);
    ctx.fillRect(pipe.x,pipe.topHeight+pipeGap,pipeWidth,height-(pipe.topHeight+pipeGap));
  });

  // 绘制玩家
  ctx.fillStyle = '#2196f3';
  ctx.fillRect(player.x,player.y,player.size,player.size);

  if(gameOver){
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillRect(0,height/2-50,width,100);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 30px Product Sans';
    ctx.textAlign = 'center';
    ctx.fillText('游戏结束', width/2, height/2+10);
  }

  requestAnimationFrame(draw);
}

function loop(){
  update();
  if(!gameOver) setTimeout(loop,1000/60);
}

function endGame(){
  gameOver = true;
  document.getElementById('buttonsContainer').style.display = 'flex';
}

// 重置游戏
function resetGame(){
  player = { x:50, y:height/2, size:30, vy:0 };
  score = 0;
  document.getElementById('score').textContent = score;
  gameOver = false;
  document.getElementById('buttonsContainer').style.display = 'none';
  initPipes();
  loop();
}

// 初始化
initPipes();
loop();

// 按钮事件
document.getElementById('restartBtn').addEventListener('click',resetGame);
</script>
</body>
</html>