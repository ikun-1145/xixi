<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>霜蓝小游戏</title>
<link href="https://fonts.googleapis.com/css2?family=Product+Sans&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: 'Product Sans', sans-serif;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    min-height:100vh; background:#e0faff; color:#1A1A1A;
  }
  canvas {
    background: #71f8fc;
    display:block;
    border-radius:12px;
    margin-top:2rem;
  }
  .game-over-buttons {
    display:none;
    margin-top:1rem;
    gap:1rem;
    flex-wrap:wrap;
  }
  .game-over-buttons button {
    padding:0.8rem 1.5rem;
    border-radius:30px;
    border:none;
    font-size:1.1rem;
    font-weight:bold;
    background: linear-gradient(to right, #71f8fc, #a0fff8);
    color:black;
    cursor:pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .game-over-buttons button:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
  }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div class="game-over-buttons" id="buttonsContainer">
  <button id="restartBtn">重新开始</button>
  <button id="homeBtn">返回主页</button>
</div>

<script>
// ===== Canvas & 自适应 =====
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  canvas.width = window.innerWidth * 0.9;
  canvas.height = window.innerHeight * 0.6;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

// ===== 游戏参数 =====
let player = { x:50, y:canvas.height/2, size:30, velocity:0 };
const gravity = 0.3;        // 下落速度
const jumpStrength = 6;     // 点击上升高度
let pipes = [];
const pipeWidth = 60;
const pipeGap = 180;        // 上下管子间距
let pipeDistance = 300;     // 前后管子间距
let gameOver = false;
let score = 0;

// ===== 初始化管子 =====
function createPipe(x) {
  const topHeight = Math.random() * (canvas.height - pipeGap - 100) + 50;
  pipes.push({ x, topHeight });
}
for(let i=0;i<3;i++){
  createPipe(canvas.width + i*pipeDistance);
}

// ===== 游戏逻辑 =====
function update() {
  if(gameOver) return;

  // 玩家受力
  player.velocity += gravity;
  player.y += player.velocity;

  // 边界检测
  if(player.y + player.size > canvas.height || player.y < 0){
    endGame();
  }

  // 管子移动 & 碰撞检测
  for(let pipe of pipes){
    pipe.x -= 2; // 管子移动速度

    // 撞管子
    if(player.x + player.size > pipe.x && player.x < pipe.x + pipeWidth){
      if(player.y < pipe.topHeight || player.y + player.size > pipe.topHeight + pipeGap){
        endGame();
      }
    }

    // 出屏则重置
    if(pipe.x + pipeWidth < 0){
      pipe.x = canvas.width + pipeDistance;
      pipe.topHeight = Math.random() * (canvas.height - pipeGap - 100) + 50;
      score++;
    }
  }
}

// ===== 绘制 =====
function draw() {
  // 背景
  ctx.fillStyle = '#71f8fc';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // 玩家（小方块，可后续换图片）
  ctx.fillStyle = '#ffcc00';
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // 管子
  ctx.fillStyle = '#2b7a78';
  for(let pipe of pipes){
    // 上管子
    ctx.fillRect(pipe.x, 0, pipeWidth, pipe.topHeight);
    // 下管子
    ctx.fillRect(pipe.x, pipe.topHeight + pipeGap, pipeWidth, canvas.height - (pipe.topHeight + pipeGap));
  }

  // 分数
  ctx.fillStyle = '#1A1A1A';
  ctx.font = '20px Product Sans';
  ctx.fillText(`分数: ${score}`, 10, 30);
}

// ===== 游戏循环 =====
function gameLoop() {
  update();
  draw();
  if(!gameOver){
    requestAnimationFrame(gameLoop);
  }
}

// ===== 点击控制 =====
canvas.addEventListener('click', () => {
  if(!gameOver){
    player.velocity = -jumpStrength;
  }
});

// ===== 游戏结束 =====
const buttonsContainer = document.getElementById('buttonsContainer');
function endGame(){
  gameOver = true;
  buttonsContainer.style.display = 'flex';
}

// ===== 按钮事件 =====
document.getElementById('restartBtn').addEventListener('click', () => {
  // 重置参数
  player.y = canvas.height/2;
  player.velocity = 0;
  pipes = [];
  for(let i=0;i<3;i++) createPipe(canvas.width + i*pipeDistance);
  score = 0;
  gameOver = false;
  buttonsContainer.style.display = 'none';
  gameLoop();
});

document.getElementById('homeBtn').addEventListener('click', () => {
  window.location.href = 'index.html';
});

// ===== 启动游戏 =====
gameLoop();
</script>

</body>
</html>