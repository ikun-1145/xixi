<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="pageTitle">ÊçêËµ†ÊîØÊåÅ - ÈúúËìù</title>
  <style>
    body {
  opacity: 0;
}

    html {
      background: #b9dde5;
    }

:root {
  /* Êó•Èó¥‰∏ªÈ¢òÔºà‰∏ªÈ°µÂêåÊ¨æÔºâ */
  --bg-main-day: linear-gradient(135deg, #b9dde5, #d2ebf0), url('p/bg.png') center / cover no-repeat;
  --card-bg-day: rgba(255,255,255,0.55);
  --text-day: #1f2f33;     /* ‰∏ªÊñáÂ≠óÔºåÊòéÊòæÊõ¥Ê∑± */
  --accent-day: #2fbec4;  /* ÂéªËçßÂÖâÁöÑËìùÁªøÂº∫Ë∞ÉËâ≤ */

  /* Â§úÈó¥‰∏ªÈ¢òÔºàdonate ÂΩìÂâçÔºâ */
  --bg-main-night: #161823;
  --card-bg-night: rgba(22, 24, 35, 0.9);
  --text-night: #E8FFFF;
  --accent-night: #3EEDE7;
}
    body {
      font-family: "Helvetica Neue", sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-main-night);
      color: var(--text-night);
    }

    body.day {
      background: var(--bg-main-day);
      color: var(--text-day);
    }

    .container {
      position: relative;
      max-width: 800px;
      margin: 80px auto;
      padding: 30px;
      background-color: var(--card-bg-night);
      border-radius: 15px;
      box-shadow: 0 0 24px rgba(62, 237, 231, 0.35);
      animation: fadeInUp 1s ease-out;
    }
    body.day .container {
      background-color: rgba(225, 242, 247, 0.92);
      box-shadow: 0 18px 40px rgba(0,0,0,0.16);
    }

    body.day p,
    body.day span,
    body.day .thanks-item .msg,
    body.day .thanks-item .time,
    body.day #tierHintText {
      color: var(--text-day);
    }

body.day .thanks-item {
  background: rgba(225, 240, 244, 0.95);
  border-color: rgba(47,190,196,0.45);
}
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      text-align: center;
      color: var(--primary);
      margin-bottom: 20px;
    }

    .tier-group {
      display: flex;
      justify-content: center;
      gap: 14px;
      flex-wrap: wrap;
      margin: 18px 0 10px;
    }

    .tier-btn {
      background: rgba(62,237,231,0.15);
      border: 1px solid rgba(62,237,231,0.6);
      color: var(--primary);
      padding: 10px 16px;
      border-radius: 20px;
      cursor: pointer;
      transition: .25s;
      font-size: 14px;
    }

    .tier-btn:hover {
      background: rgba(62,237,231,0.35);
      transform: translateY(-2px);
    }

    .tier-btn.active {
      background: var(--primary);
      color: var(--bg-deep);
      box-shadow:
        0 0 0 2px rgba(62,237,231,0.6),
        0 10px 30px rgba(62,237,231,0.45);
    }

    #thanksToast {
      position: fixed;
      left: 50%;
      bottom: 14%;
      transform: translateX(-50%) scale(.9);
      background: rgba(0,0,0,0.7);
      color: var(--primary);
      padding: 14px 26px;
      border-radius: 30px;
      opacity: 0;
      pointer-events: none;
      transition: .35s ease;
      box-shadow: 0 10px 40px rgba(62,237,231,0.4);
      z-index: 9999;
    }

    #thanksToast.show {
      opacity: 1;
      transform: translateX(-50%) scale(1);
    }

    .qrcode-section {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 30px;
      margin: 40px 0;
    }

    .amount-center {
      text-align: center;
      margin: 0;
    }

    .amount-center span {
      display: inline-block;
      font-size: 24px;
      font-weight: 800;
      color: var(--bg-deep);
      padding: 8px 22px;
      border-radius: 999px;
      background: linear-gradient(135deg, #3EEDE7, #7CFFF9);
      letter-spacing: 1px;
    }

    .qrcode {
      background: rgba(5, 49, 84, 0.55);
      border-radius: 16px;
      padding: 18px 16px 22px;
      text-align: center;
      box-shadow: 0 8px 30px rgba(62,237,231,0.15);
      transition: transform .25s ease, box-shadow .25s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .qrcode:hover {
      transform: translateY(-6px) scale(1.02);
      box-shadow: 0 12px 40px rgba(62,237,231,0.35);
    }

    .qrcode::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 20%, rgba(62,237,231,0.25), transparent 60%);
      opacity: 0;
      transition: .3s;
      pointer-events: none;
    }

    .qrcode:hover::after {
      opacity: 1;
    }

    .qrcode img {
      width: 180px;
      height: auto;
      border-radius: 12px;
      margin-bottom: 10px;
      transition: transform .25s ease;
    }

    .qrcode.flash {
      animation: qrFlash 0.35s ease;
    }

    @keyframes qrFlash {
      0%   { transform: scale(1); box-shadow: 0 0 0 rgba(62,237,231,0); }
      50%  { transform: scale(1.06); box-shadow: 0 0 20px rgba(62,237,231,0.6); }
      100% { transform: scale(1); box-shadow: 0 0 0 rgba(62,237,231,0); }
    }

    .amount-flash {
      animation: amountFlash 0.4s ease;
    }

    @keyframes amountFlash {
      from { opacity: 0.3; transform: translateY(4px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .qrcode:hover img {
      transform: scale(1.05);
    }

    .qrcode p {
      margin: 8px 0 0;
      font-size: 15px;
      color: var(--primary);
      letter-spacing: 1px;
    }

    .btn-group {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }

    button {
      background-color: var(--primary);
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      color: black;
      transition: 0.3s;
    }

    button:hover {
      background-color: #5ae0e6;
    }

    .footer {
      text-align: center;
      margin-top: 40px;
      color: #ccc;
      font-size: 14px;
    }
body.day .footer {
  color: #3f5f66;
}
    @media (max-width: 600px) {
      .qrcode-section {
        grid-template-columns: 1fr;
        gap: 24px;
      }
      .amount-center {
        order: -1;
        margin-bottom: 8px;
      }
    }
    .thanks-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 10px;
    }

    .thanks-item {
      background: rgba(5, 49, 84, 0.55);
      border: 1px solid rgba(62,237,231,0.25);
      border-radius: 14px;
      padding: 12px 14px;
      box-shadow: 0 6px 18px rgba(62,237,231,0.15);
      animation: fadeInUp .4s ease both;
    }
    .thanks-item.mine {
  border-color: var(--primary);
  box-shadow:
    0 0 0 2px rgba(62,237,231,0.35),
    0 10px 30px rgba(62,237,231,0.35);
  background: rgba(62,237,231,0.12);
  position: relative;
}

.thanks-item.mine::before {
  content: "‰Ω†ÁöÑÁïôË®Ä";
  position: absolute;
  top: -10px;
  right: 10px;
  background: var(--primary);
  color: #000;
  font-size: 11px;
  padding: 2px 8px;
  border-radius: 999px;
  box-shadow: 0 4px 10px rgba(62,237,231,0.4);
}
    .thanks-item .name {
      color: var(--primary);
      font-size: 14px;
      margin-bottom: 4px;
    }

    .thanks-item .msg {
      color: #ddd;
      font-size: 13px;
      line-height: 1.4;
      opacity: .9;
    }

    .thanks-item .time {
      margin-top: 6px;
      font-size: 12px;
      color: #9fdde0;
      opacity: .8;
      text-align: right;
    }

    .thanks-item .like-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      gap: 8px;
    }

    .like-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      background: rgba(62,237,231,0.15);
      border: 1px solid rgba(62,237,231,0.6);
      color: var(--primary);
      border-radius: 999px;
      padding: 2px 10px;
      font-size: 12px;
      cursor: pointer;
      transition: .2s ease;
    }

    .like-btn .heart {
      position: relative;
      width: 10px;
      height: 10px;
      transform: rotate(-45deg);
      display: inline-block;
      background: var(--primary);
      border-radius: 2px;
    }

    .like-btn .heart::before,
    .like-btn .heart::after {
      content: "";
      position: absolute;
      width: 10px;
      height: 10px;
      background: var(--primary);
      border-radius: 50%;
    }

    .like-btn .heart::before {
      top: -5px;
      left: 0;
    }

    .like-btn .heart::after {
      left: 5px;
      top: 0;
    }

    .like-btn.liked {
      background: var(--primary);
      color: #000;
    }

    .like-btn.liked .heart {
      filter: drop-shadow(0 0 6px rgba(62,237,231,0.8));
      animation: heartPop 0.3s ease;
    }

    .like-btn:not(.liked) .heart {
      opacity: 0.35;
    }

    @keyframes heartPop {
      0% { transform: scale(1); }
      50% { transform: scale(1.25); }
      100% { transform: scale(1); }
    }

    .thanks-form {
      margin-top: 26px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      background: rgba(5, 49, 84, 0.55);
      border: 1px solid rgba(62,237,231,0.35);
      border-radius: 18px;
      padding: 18px 16px 20px;
      box-shadow: 0 10px 35px rgba(62,237,231,0.18);
    }
    body.day .thanks-form {
  background: rgba(215, 235, 240, 0.95);
  border-color: rgba(47,190,196,0.45);
  box-shadow: 0 14px 32px rgba(0,0,0,0.18);
}

body.day .thanks-form input,
body.day .thanks-form textarea {
  background: rgba(255,255,255,0.85);
  color: #1f2f33;
  border-color: rgba(47,190,196,0.45);
}

body.day .thanks-form input::placeholder,
body.day .thanks-form textarea::placeholder {
  color: #6b8a91;
}

    .thanks-title {
      margin: 0;
      text-align: center;
      font-size: 15px;
      color: var(--primary);
      letter-spacing: 1px;
    }

    .thanks-fields {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .thanks-form input,
    .thanks-form textarea {
      background: rgba(0,0,0,0.45);
      border: 1px solid rgba(62,237,231,0.45);
      border-radius: 12px;
      padding: 10px 12px;
      color: #fff;
      outline: none;
      font-size: 14px;
      resize: none;
      transition: border .2s ease, box-shadow .2s ease, background .2s ease;
    }

    .thanks-form input:focus,
    .thanks-form textarea:focus {
      border-color: var(--primary);
      background: rgba(0,0,0,0.55);
      box-shadow: 0 0 0 2px rgba(62,237,231,0.25);
    }

    .thanks-form input::placeholder,
    .thanks-form textarea::placeholder {
      color: #aaa;
    }

    .thanks-form button {
      align-self: center;
      padding: 10px 28px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--primary), #9ffcff);
      border: none;
      cursor: pointer;
      transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
      box-shadow: 0 6px 18px rgba(62,237,231,0.45);
      font-weight: bold;
      letter-spacing: 1px;
    }

    .thanks-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 26px rgba(62,237,231,0.6);
      filter: brightness(1.05);
    }

    .thanks-form button:disabled {
      opacity: .6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #thanksTip {
      text-align: center;
      font-size: 12px;
      color: #aaa;
    }

    /* È™®Êû∂Â±èÂä†ËΩΩÊïàÊûú */
    .thanks-item.skeleton {
      height: 58px;
      background: linear-gradient(100deg,
        rgba(5, 49, 84, 0.18) 40%,
        rgba(5, 49, 84, 0.33) 50%,
        rgba(5, 49, 84, 0.18) 60%);
      background-size: 200% 100%;
      animation: skeleton 1.2s ease infinite;
    }

    @keyframes skeleton {
      to { background-position: -200% 0; }
    }
    /* ‰∫åÁª¥Á†ÅÊîæÂ§ßÈ¢ÑËßà */
    .img-preview {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeIn .3s ease;
    }

    .img-preview.active {
      display: flex;
    }

    .img-preview img {
      max-width: 80vw;
      max-height: 80vh;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Âä†ËΩΩÂä®ÁîªÊ†∑Âºè */
    #loading {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.6s ease;
      background: radial-gradient(
        circle at center,
        rgba(113,248,252,0.18),
        #f2feff 65%
      );
    }

    body:not(.day) #loading {
      background: radial-gradient(
        circle at center,
        rgba(62,237,231,0.14),
        rgba(22,24,35,0.96) 65%
      );
    }
    /* ‰∏ªÈ¢òÂº∫Ë∞ÉËâ≤ÂèòÈáèÈÄÇÈÖç */
    body {
      --primary: var(--accent-night);
    }

    body.day {
      --primary: var(--accent-day);
    }

    .loader {
      border: 6px solid rgba(255,255,255,0.12);
      border-top: 6px solid var(--primary);
      border-radius: 50%;
      width: 56px;
      height: 56px;
      animation: spin 1s linear infinite;
      box-shadow: 0 0 20px rgba(62,237,231,0.35);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    body.fade-in {
      animation: fadeBody 0.8s ease;
    }

    @keyframes fadeBody {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    body.fade-out {
      animation: fadeOut 0.6s ease forwards;
    }

    @keyframes fadeOut {
      to { opacity: 0; }
    }
  </style>
</head>
<body>
  <!-- Âä†ËΩΩÂä®Áîª -->
  <div id="loading">
    <div class="loader"></div>
  </div>

  <!-- ‰∫åÁª¥Á†ÅÊîæÂ§ßÈ¢ÑËßàÂ±Ç -->
  <div id="imgPreview" class="img-preview">
    <img id="previewImg" src="" alt="È¢ÑËßà">
  </div>

  <div id="thanksToast">ÊÑüË∞¢‰Ω†ÁöÑÊîØÊåÅÔºÅüíô</div>

  <div class="container">
    <h1 id="titleText"></h1>
    <p id="userGreeting" style="text-align:center; margin-top:-10px; color: var(--primary);"></p>
    <button id="logoutBtn" style="
      position:absolute;
      top:20px;
      right:20px;
      background: rgba(113,248,252,0.9);
      border: none;
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      color: black;
      transition: 0.3s;
      z-index: 10;
    "> </button>
    <p id="supportDesc" style="text-align:center;"></p>

    <div class="tier-group">
      <button class="tier-btn" data-tier="coffee">‚òï <span id="tierCoffee"></span></button>
      <button class="tier-btn" data-tier="meal">üçî <span id="tierMeal"></span></button>
      <button class="tier-btn" data-tier="biglove">üíñ <span id="tierBiglove"></span></button>
    </div>

    <p id="tierHintText" style="text-align:center; margin-top:12px; color:#ccc; font-size:14px;"></p>
    
    <div class="qrcode-section">
      <div class="qrcode">
        <img id="wxQr" src="p/ten_wx.jpeg" alt="ÂæÆ‰ø°Êî∂Ê¨æÁ†Å" loading="lazy" decoding="async" />
        <p id="wxPayText"></p>
      </div>
      <div class="amount-center">
        <span id="amountText"></span>
      </div>
      <div class="qrcode">
        <img id="zfbQr" src="p/ten_zfb.jpeg" alt="ÊîØ‰ªòÂÆùÊî∂Ê¨æÁ†Å" loading="lazy" decoding="async" />
        <p id="aliPayText"></p>
      </div>
    </div>

    <h2 style="text-align:center; color:#71f8fc; margin-top:40px;"><span id="thanksBoardTitle"></span></h2>
    <p style="text-align:center; color:#ccc; font-size:14px; margin-bottom:14px;">
      <span id="thanksBoardDesc"></span>
    </p>

    <div id="thanksList" class="thanks-list">
      <div class="thanks-item skeleton"></div>
      <div class="thanks-item skeleton"></div>
      <div class="thanks-item skeleton"></div>
    </div>
    <div id="loadMoreWrap" style="text-align:center; margin-top:14px;">
      <button id="loadMoreBtn" style="
        background: rgba(113,248,252,0.2);
        border: 1px solid rgba(113,248,252,0.6);
        color: #71f8fc;
        padding: 8px 18px;
        border-radius: 20px;
        cursor: pointer;
      ">
        <span id="loadMoreText"></span>
      </button>
    </div>
    <div class="thanks-form">
      <h3 class="thanks-title"><span id="thanksFormTitle"></span></h3>
      <div class="thanks-fields">
        <input id="thanksName" type="text" placeholder="">
        <textarea id="thanksMsg" rows="3" placeholder=""></textarea>
      </div>
      <button id="submitThanks"><span id="submitThanksText"></span></button>
      <p id="thanksTip"><span id="thanksTipText"></span></p>
    </div>

    <div class="btn-group">
      <button id="backBtn"></button>
    </div>

    <div class="footer">
      Copyright¬©Ô∏è2024-2026 ÈúúËìù, All Rights Reserved.
    </div>
  </div>

  <!-- Ë∑≥ËΩ¨‰∏éÂä†ËΩΩÈÄªËæë -->
  <script>
    (function applyDonateAutoTheme() {
      const hour = new Date().getHours();
      const isDay = hour >= 6 && hour < 18;
      document.body.classList.toggle('day', isDay);
    })();
    /* --------- i18n --------- */
    const i18n = {
      zh: {
        pageTitle: "ÊçêËµ†ÊîØÊåÅ - ÈúúËìù",
        title: "ÊÑüË∞¢‰Ω†ÁöÑÊîØÊåÅÔºÅ",
        supportDesc: "Â¶ÇÊûú‰Ω†ÂñúÊ¨¢Êú¨Á´ôÂÜÖÂÆπÔºåÂèØ‰ª•ÈÄâÊã©‰∏Ä‰∏™ÊñπÂºèÊîØÊåÅÊàëÔºö",
        tierCoffee: "ËØ∑‰Ω†ÂñùÊùØÂíñÂï°",
        tierMeal: "ËØ∑‰Ω†ÂêÉÈ°øÈ•≠",
        tierBiglove: "Áã†Áã†ÊîØÊåÅ‰∏Ä‰∏ã",
        tierHint: "ÈÄâÊã©Ê°£‰ΩçÂêéÔºåÊâ´Á†ÅÊîØ‰ªòÂç≥ÂèØÔΩû",
        wxPay: "ÂæÆ‰ø°ÊîØ‰ªò",
        aliPay: "ÊîØ‰ªòÂÆù",
        boardTitle: "üíñ Á≤â‰∏ùÈ∏£Ë∞¢Ê¶ú",
        boardDesc: "ÊÑüË∞¢ÊØè‰∏Ä‰ΩçÊîØÊåÅÈúúËìùÁöÑÊúãÂèãÔºàÊåâÊó∂Èó¥ÂÄíÂ∫èÔºâ",
        loadMore: "Âä†ËΩΩÊõ¥Â§ö",
        formTitle: "‚úç Áïô‰∏ã‰Ω†ÁöÑÊîØÊåÅÁïôË®Ä",
        namePh: "‰Ω†ÁöÑÊòµÁß∞ÔºàÂèØÁïôÁ©∫Ôºâ",
        msgPh: "ÊÉ≥ÂØπÈúúËìùËØ¥ÁöÑËØùÔºàÂèØÈÄâÔºâ",
        submit: "Êèê‰∫§Âà∞È∏£Ë∞¢Ê¶ú",
        tip: "Êèê‰∫§Âêé‰ºöÊòæÁ§∫Âú®Ê¶úÂçï‰∏≠ üíô",
        back: "ËøîÂõû‰∏ªÈ°µ",
        logout: "ÈÄÄÂá∫ÁôªÂΩï",
        greeting: (name) => `Ê¨¢Ëøé‰Ω†Ôºå${name || "ÊúãÂèã"} üíô`
      },
      en: {
        pageTitle: "Support - Sunland",
        title: "Thank you for your support!",
        supportDesc: "If you enjoy this site, you can support me in one of these ways:",
        tierCoffee: "Buy me a coffee",
        tierMeal: "Buy me a meal",
        tierBiglove: "Big support!",
        tierHint: "Choose a tier and scan to pay.",
        wxPay: "WeChat Pay",
        aliPay: "Alipay",
        boardTitle: "üíñ Supporter Board",
        boardDesc: "Thanks to everyone who supports Sunland (latest first)",
        loadMore: "Load more",
        formTitle: "‚úç Leave your message",
        namePh: "Your nickname (optional)",
        msgPh: "Message to Sunland (optional)",
        submit: "Submit",
        tip: "Your message will appear on the board üíô",
        back: "Back to Home",
        logout: "Log out",
        greeting: (name) => `Welcome, ${name || "friend"} üíô`
      },
      jp: {
        pageTitle: "ÊîØÊè¥ - „Éï„É≠„Çπ„Éà",
        title: "ÂøúÊè¥„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ",
        supportDesc: "„ÇÇ„Åó„Åì„ÅÆ„Çµ„Ç§„Éà„ÅåÊ∞ó„Å´ÂÖ•„Å£„Åü„Çâ„ÄÅ„Åú„Å≤ÊîØÊè¥„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö",
        tierCoffee: "„Ç≥„Éº„Éí„Éº„Çí„Åî„Å°„Åù„ÅÜ",
        tierMeal: "„ÅîÈ£Ø„Çí„Åî„Å°„Åù„ÅÜ",
        tierBiglove: "ÂÖ®Âäõ„ÅßÂøúÊè¥ÔºÅ",
        tierHint: "ÈáëÈ°ç„ÇíÈÅ∏„Çì„ÅßQR„Ç≥„Éº„Éâ„ÅßÊîØÊâï„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        wxPay: "WeChat Pay",
        aliPay: "Alipay",
        boardTitle: "üíñ ÂøúÊè¥ËÄÖ‰∏ÄË¶ß",
        boardDesc: "„Éï„É≠„Çπ„Éà„ÇíÂøúÊè¥„Åó„Å¶„Åè„Çå„ÇãÁöÜ„Åï„Çì„Å∏ÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ",
        loadMore: "„ÇÇ„Å£„Å®Ë¶ã„Çã",
        formTitle: "‚úç ÂøúÊè¥„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÊõ∏„Åè",
        namePh: "„Éã„ÉÉ„ÇØ„Éç„Éº„É†Ôºà‰ªªÊÑèÔºâ",
        msgPh: "„Éï„É≠„Çπ„Éà„Å∏„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Ôºà‰ªªÊÑèÔºâ",
        submit: "ÈÄÅ‰ø°",
        tip: "ÈÄÅ‰ø°Âæå„ÄÅ‰∏ÄË¶ß„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô üíô",
        back: "„Éõ„Éº„É†„Å∏Êàª„Çã",
        logout: "„É≠„Ç∞„Ç¢„Ç¶„Éà",
        greeting: (name) => `„Çà„ÅÜ„Åì„Åù„ÄÅ${name || "ÂèãÈÅî"} üíô`
      }
    };

    function applyLangDonate(nameForGreeting) {
      const lang = localStorage.getItem("lang") || "zh";
      const t = i18n[lang] || i18n.zh;

      document.title = t.pageTitle;
      document.getElementById("titleText").textContent = t.title;
      document.getElementById("supportDesc").textContent = t.supportDesc;

      document.getElementById("tierCoffee").textContent = t.tierCoffee;
      document.getElementById("tierMeal").textContent = t.tierMeal;
      document.getElementById("tierBiglove").textContent = t.tierBiglove;
      document.getElementById("tierHintText").textContent = t.tierHint;

      document.getElementById("wxPayText").textContent = t.wxPay;
      document.getElementById("aliPayText").textContent = t.aliPay;

      document.getElementById("thanksBoardTitle").textContent = t.boardTitle;
      document.getElementById("thanksBoardDesc").textContent = t.boardDesc;

      document.getElementById("loadMoreText").textContent = t.loadMore;
      document.getElementById("thanksFormTitle").textContent = t.formTitle;

      document.getElementById("submitThanksText").textContent = t.submit;
      document.getElementById("thanksTipText").textContent = t.tip;

      document.getElementById("backBtn").textContent = t.back;
      document.getElementById("logoutBtn").textContent = t.logout;

      const nameInput = document.getElementById("thanksName");
      const msgInput = document.getElementById("thanksMsg");
      if (nameInput) nameInput.placeholder = t.namePh;
      if (msgInput) msgInput.placeholder = t.msgPh;

      const greet = document.getElementById("userGreeting");
      if (greet) greet.textContent = t.greeting(nameForGreeting);
    }
    window.applyLangDonate = applyLangDonate;

window.addEventListener('load', () => {
  // ‚úÖ Reveal page ONLY after loading finishes
  document.body.style.opacity = '1';

  document.body.classList.add('fade-in');
  const loader = document.getElementById('loading');
  if (loader) {
    loader.style.opacity = '0';
    setTimeout(() => loader.style.display = 'none', 600);
  }
  window.applyLangDonate && window.applyLangDonate(null);
});

    // ÊâÄÊúâ a[href] ÂíåÊåâÈíÆË∑≥ËΩ¨Ê∑ªÂä†Ê∑°Âá∫Âä®Áîª
    document.addEventListener("DOMContentLoaded", () => {
      // ÈìæÊé•Ë∑≥ËΩ¨Â§ÑÁêÜ
      const links = document.querySelectorAll("a[href]");
      links.forEach(link => {
        const href = link.getAttribute("href");
        if (!href.startsWith("#") && !href.startsWith("javascript")) {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            document.body.classList.add("fade-out");
            setTimeout(() => window.location.href = href, 600);
          });
        }
      });

      // ÊåâÈíÆË∑≥ËΩ¨Â§ÑÁêÜ
      const backBtn = document.getElementById("backBtn");
      if (backBtn) {
        backBtn.addEventListener("click", () => {
          document.body.classList.add("fade-out");
          setTimeout(() => window.location.href = "index.html", 600);
        });
      }
    });

    // ÁÇπÂáª‰∫åÁª¥Á†ÅÊîæÂ§ßÈ¢ÑËßà
    const preview = document.getElementById("imgPreview");
    const previewImg = document.getElementById("previewImg");

    preview.addEventListener("click", () => {
      preview.classList.remove("active");
    });
  </script>
  <script type="module">
    import { supabase } from '/p/js/supabaseClient.js';
      // ===== donate È°µÈù¢ÁôªÂΩïÂÆàÈó® =====
  const {
    data: { session }
  } = await supabase.auth.getSession();

  if (!session) {
    // Êú™ÁôªÂΩïÔºåÂº∫Âà∂Âõû‰∏ªÈ°µ
    location.replace('/');
    throw new Error('Not logged in');
  }

    // Êó∂Èó¥Ê†ºÂºèÂåñËæÖÂä©
    function formatTime(iso) {
      if (!iso) return "";

      const t = new Date(iso);
      const now = new Date();
      const diff = (now - t) / 1000;

      if (diff < 60) return "ÂàöÂàö";
      if (diff < 3600) return Math.floor(diff / 60) + " ÂàÜÈíüÂâç";
      if (diff < 86400) return Math.floor(diff / 3600) + " Â∞èÊó∂Ââç";

      const isToday = now.toDateString() === t.toDateString();
      if (isToday) {
        return "‰ªäÂ§© " + pad(t.getHours()) + ":" + pad(t.getMinutes());
      }

      return (
        (t.getMonth() + 1) + "Êúà" +
        t.getDate() + "Êó• " +
        pad(t.getHours()) + ":" +
        pad(t.getMinutes())
      );
    }

    function pad(n) {
      return n < 10 ? "0" + n : n;
    }

    // Âä†ËΩΩÁ≤â‰∏ùÈ∏£Ë∞¢Ê¶ú
    const thanksList = document.getElementById("thanksList");
    let thanksPage = 0;
    const PAGE_SIZE = 8;

    let currentUserEmail = null;
    let currentUserId = null;
    async function loadThanks(reset = false) {
      if (reset) {
        thanksPage = 0;
        if (thanksList) {
          thanksList.innerHTML = `
            <div class="thanks-item skeleton"></div>
            <div class="thanks-item skeleton"></div>
            <div class="thanks-item skeleton"></div>
          `;
        }
      }

      const from = thanksPage * PAGE_SIZE;
      const to = from + PAGE_SIZE - 1;

      const { data, error } = await supabase
        .from("thanks")
        .select("id, name, message, created_at")
        .order("created_at", { ascending: false })
        .range(from, to);

      if (error || !data) {
        if (thanksList && reset) {
          thanksList.innerHTML = '<div class="thanks-item"><div class="msg">ÊöÇÊó†È∏£Ë∞¢ËÆ∞ÂΩïÔºåÊúüÂæÖ‰Ω†ÁöÑÁ¨¨‰∏Ä‰ªΩÊîØÊåÅ üíô</div></div>';
        }
        return;
      }

      if (thanksList) {
        if (reset) thanksList.innerHTML = "";

        const html = data.map(item => {
          const isMine = currentUserEmail && item.name === currentUserEmail;
          return `
          <div class="thanks-item ${isMine ? "mine" : ""}" data-id="${item.id}">
            <div class="name">${item.name || "ÂåøÂêçÊúãÂèã"}</div>
            <div class="msg">${item.message || "ÊÑüË∞¢ÊîØÊåÅÔºÅ"}</div>
            <div class="like-row">
              <div class="time">${formatTime(item.created_at)}</div>
              <button class="like-btn">
                <span class="heart"></span>
                <span class="like-count">0</span>
              </button>
            </div>
          </div>
          `;
        }).join("");

        thanksList.insertAdjacentHTML("beforeend", html);
      }

      const loadMoreBtn = document.getElementById("loadMoreBtn");
      if (loadMoreBtn) {
        if (data.length < PAGE_SIZE) {
          loadMoreBtn.style.display = "none";
        } else {
          loadMoreBtn.style.display = "inline-block";
        }
      }

      thanksPage++;
    }

    // ÊòæÁ§∫Áî®Êà∑ÊòµÁß∞/ÈÇÆÁÆ±ÔºåÂπ∂‰øùÂ≠òÂΩìÂâçÁî®Êà∑ÈÇÆÁÆ±
    let user = session?.user || null;
    currentUserEmail = user?.email || null;
    currentUserId = user?.id || null;

    const greet = document.getElementById("userGreeting");
    if (greet) {
      const name = user?.user_metadata?.name || user?.email || null;
      window.applyLangDonate && window.applyLangDonate(name);
    }

    loadThanks(true);

    const loadMoreBtn = document.getElementById("loadMoreBtn");
    if (loadMoreBtn) {
      loadMoreBtn.addEventListener("click", () => {
        loadThanks(false);
      });
    }

    // ÁÇπËµû / ÂèñÊ∂àÁÇπËµûÔºà‰∏Ä‰∫∫‰∏ÄÁ•®Ôºâ
    thanksList.addEventListener("click", async (e) => {
      const btn = e.target.closest(".like-btn");
      if (!btn) return;

      if (!session) {
        alert("ËØ∑ÂÖàÁôªÂΩïÂÜçÁÇπËµû üíô");
        return;
      }

      const item = btn.closest(".thanks-item");
      const thanksId = item.dataset.id;

      btn.disabled = true;

      const isLiked = btn.classList.contains("liked");
      // Find the like-count span for updating
      const countSpan = btn.querySelector(".like-count");
      let count = parseInt(countSpan ? countSpan.textContent : "0", 10);

      if (!isLiked) {
        // ÁÇπËµû
        const { error } = await supabase.from("thanks_likes").insert({
          thanks_id: thanksId,
          user_id: currentUserId
        });

        if (!error) {
          count = count + 1;
          if (countSpan) countSpan.textContent = count;
          btn.classList.add("liked");
        }
      } else {
        // ÂèñÊ∂àÁÇπËµû
        const { error } = await supabase
          .from("thanks_likes")
          .delete()
          .eq("thanks_id", thanksId)
          .eq("user_id", currentUserId);

        if (!error) {
          count = Math.max(0, count - 1);
          if (countSpan) countSpan.textContent = count;
          btn.classList.remove("liked");
        }
      }

      btn.disabled = false;
    });

    // ÈÄÄÂá∫ÁôªÂΩïÔºàÂº∫Âà∂ÂèØÁî®ÁâàÔºâ
    const logoutBtn = document.getElementById("logoutBtn");
    if (logoutBtn) {
      logoutBtn.addEventListener("click", async (e) => {
        e.preventDefault();
        e.stopPropagation();

        try {
          await supabase.auth.signOut();
          console.log("Signed out");
        } catch (err) {
          console.warn("Sign out failed, redirect anyway:", err);
        }

        document.body.classList.add("fade-out");
        setTimeout(() => window.location.href = "/", 600);
      });
    }

    // Êèê‰∫§È∏£Ë∞¢ÁïôË®Ä
    const submitBtn = document.getElementById("submitThanks");
    const nameInput = document.getElementById("thanksName");
    const msgInput = document.getElementById("thanksMsg");
    const tip = document.getElementById("thanksTip");

    if (submitBtn) {
      submitBtn.addEventListener("click", async () => {
        submitBtn.disabled = true;
        submitBtn.textContent = "Êèê‰∫§‰∏≠...";

        // ‰ΩøÁî® session Âà§Êñ≠ÁôªÂΩï
        let user = session?.user || null;

        const name =
          nameInput.value.trim() ||
          user?.user_metadata?.name ||
          user?.email ||
          "ÂåøÂêçÊúãÂèã";

        const message = msgInput.value.trim() || "ÊÑüË∞¢ÊîØÊåÅÔºÅ";

        const { error } = await supabase.from("thanks").insert({
          name,
          message
        });

        if (error) {
          console.error(error);
          tip.textContent = "Êèê‰∫§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï";
          submitBtn.disabled = false;
          submitBtn.textContent = "Êèê‰∫§Âà∞È∏£Ë∞¢Ê¶ú";
          return;
        }

        nameInput.value = "";
        msgInput.value = "";
        tip.textContent = "Â∑≤Êèê‰∫§ÔºåÊÑüË∞¢‰Ω†ÁöÑÊîØÊåÅÔºÅüíô";

        await loadThanks(true);

        submitBtn.disabled = false;
        submitBtn.textContent = "Êèê‰∫§Âà∞È∏£Ë∞¢Ê¶ú";
      });
    }

    // Ê°£‰ΩçÈÄâÊã©ÊïàÊûú
    const tierBtns = document.querySelectorAll(".tier-btn");
    const hint = document.getElementById("tierHintText");
    let selectedTier = null;

    const wxQr = document.getElementById("wxQr");
    const zfbQr = document.getElementById("zfbQr");
    const amountText = document.getElementById("amountText");

    function updateQrByTier(tier) {
      let wxSrc = "";
      let zfbSrc = "";
      let amount = "";

      if (tier === "coffee") {
        wxSrc = "p/ten_wx.jpeg";
        zfbSrc = "p/ten_zfb.jpeg";
        amount = "ÂΩìÂâçÈáëÈ¢ùÔºö¬•10";
      }
      if (tier === "meal") {
        wxSrc = "p/twenty_wx.jpeg";
        zfbSrc = "p/twenty_zfb.jpeg";
        amount = "ÂΩìÂâçÈáëÈ¢ùÔºö¬•20";
      }
      if (tier === "biglove") {
        wxSrc = "p/fifty_wx.jpeg";
        zfbSrc = "p/fifty_zfb.jpeg";
        amount = "ÂΩìÂâçÈáëÈ¢ùÔºö¬•50";
      }

      if (!wxSrc) return;

      wxQr.src = wxSrc;
      zfbQr.src = zfbSrc;
      amountText.textContent = amount;

      // Ëß¶ÂèëËßÜËßâÂèçÈ¶à
      document.querySelectorAll(".qrcode").forEach(box => {
        box.classList.remove("flash");
        void box.offsetWidth; // Âº∫Âà∂ÈáçÁªò
        box.classList.add("flash");
      });

      amountText.classList.remove("amount-flash");
      void amountText.offsetWidth;
      amountText.classList.add("amount-flash");
    }

    tierBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        tierBtns.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        selectedTier = btn.dataset.tier;
        updateQrByTier(selectedTier);

        if (selectedTier === "coffee") hint.textContent = "‚òï Â∑≤ÈÄâÊã©ÔºöÂíñÂï°Ê°£‰ΩçÔºåÊÑüË∞¢‰Ω†ÁöÑÊ∏©ÊüîÊîØÊåÅÔΩû";
        if (selectedTier === "meal") hint.textContent = "üçî Â∑≤ÈÄâÊã©ÔºöÂêÉÈ•≠Ê°£‰ΩçÔºå‰ªäÂ§©Âä†‰∏™È∏°ËÖøÔºÅ";
        if (selectedTier === "biglove") hint.textContent = "üíñ Â∑≤ÈÄâÊã©ÔºöÁã†Áã†Áà±ÊàëÊ°£‰ΩçÔºåÁúüÁöÑÂ§™ÊÑüÂä®‰∫ÜÔºÅ";
      });
    });

    // ÈªòËÆ§ÈÄâ‰∏≠ÂíñÂï°Ê°£
    const defaultBtn = document.querySelector('.tier-btn[data-tier="coffee"]');
    if (defaultBtn) {
      defaultBtn.classList.add("active");
      selectedTier = "coffee";
      updateQrByTier("coffee");
      hint.textContent = "‚òï Â∑≤ÈÄâÊã©ÔºöÂíñÂï°Ê°£‰ΩçÔºåÊÑüË∞¢‰Ω†ÁöÑÊ∏©ÊüîÊîØÊåÅÔΩû";
    }

    // Êâ´Á†ÅÁÇπÂáªÊÑüË∞¢Âä®Áîª + ‰∫åÁª¥Á†ÅÊîæÂ§ßÈ¢ÑËßà
    const toast = document.getElementById("thanksToast");
    document.querySelectorAll(".qrcode img").forEach(img => {
      img.addEventListener("click", (e) => {
        e.stopPropagation(); // ‰∏çÂΩ±ÂìçÊ°£‰ΩçÈÄªËæë
        // ÂÖàÊîæÂ§ßÈ¢ÑËßà
        previewImg.src = img.src;
        preview.classList.add("active");
        // toast Âä®Áîª
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 1800);
      });
    });
  </script>
</body>
</html>