<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>小游戏</title>
  <style>
    body { margin:0; background:#71f8fc; display:flex; flex-direction:column; height:100vh; font-family:'Product Sans', sans-serif; }
    canvas { display:block; flex:1; background:url('p/bg.png') center / cover no-repeat; }

    /* 按钮统一风格 */
    .game-button {
      display: inline-block;
      padding: 0.8rem 1.5rem;
      background: linear-gradient(to right, #71f8fc, #a0fff8);
      border-radius: 30px;
      border: none;
      color: black;
      font-weight: bold;
      font-size: 1.1rem;
      text-align: center;
      cursor: pointer;
      margin: 8px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .game-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    #buttonsContainer { text-align:center; padding:12px 0; }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="buttonsContainer" style="display:none;">
  <button id="restartBtn" class="game-button">重新开始</button>
  <button id="homeBtn" class="game-button">返回主页</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const BASE_WIDTH = 400;
const BASE_HEIGHT = 600;

let bird = { x: 50, y: 250, w: 30, h: 30, gravity: 0.4, vel: 0, lift: -8 };
let pipes = [];
let score = 0;
let gameOver = false;
const restartBtn = document.getElementById('restartBtn');
const homeBtn = document.getElementById('homeBtn');
const buttonsContainer = document.getElementById('buttonsContainer');
const PIPE_SPACING = 450; 
const PIPE_GAP = 180;

// 自适应屏幕
function resizeCanvas(){
  const aspectRatio = BASE_WIDTH/BASE_HEIGHT;
  let w = window.innerWidth;
  let h = window.innerHeight;
  if(w/h>aspectRatio){ w = h*aspectRatio; } else { h = w/aspectRatio; }
  canvas.width=w; canvas.height=h;
}
window.addEventListener('load',resizeCanvas);
window.addEventListener('resize',resizeCanvas);
function scaleX(x){return x*canvas.width/BASE_WIDTH;}
function scaleY(y){return y*canvas.height/BASE_HEIGHT;}
function scaleW(w){return w*canvas.width/BASE_WIDTH;}
function scaleH(h){return h*canvas.height/BASE_HEIGHT;}

// 生成管子
function spawnPipe(){
  let top = Math.random()*200+50;
  pipes.push({x:BASE_WIDTH, w:50, top:top, bottom:BASE_HEIGHT-top-PIPE_GAP, passed:false});
}

// 重置游戏
function resetGame(){
  bird.y=250; bird.vel=0; pipes=[]; score=0; gameOver=false;
  buttonsContainer.style.display='none';
  loop();
}

// 控制
document.addEventListener('keydown', e=>{ if(e.code==='Space') bird.vel=bird.lift; });
document.addEventListener('mousedown', ()=>{ bird.vel=bird.lift; });

// 更新
function update(){
  bird.vel += bird.gravity;
  bird.y += bird.vel;

  if(bird.y+bird.h>BASE_HEIGHT || bird.y<0) gameOver=true;

  if(pipes.length===0 || (BASE_WIDTH-pipes[pipes.length-1].x)>=PIPE_SPACING){
    spawnPipe();
  }

  pipes.forEach(pipe=>{
    pipe.x-=2;
    if(!pipe.passed && bird.x>pipe.x+pipe.w){score++; pipe.passed=true;}
    if(bird.x<pipe.x+pipe.w && bird.x+bird.w>pipe.x &&
       (bird.y<pipe.top || bird.y+bird.h>BASE_HEIGHT-pipe.bottom)) gameOver=true;
  });

  pipes = pipes.filter(p=>p.x+p.w>0);
}

// 绘制
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='blue';
  ctx.fillRect(scaleX(bird.x),scaleY(bird.y),scaleW(bird.w),scaleH(bird.h));

  ctx.fillStyle='green';
  pipes.forEach(pipe=>{
    ctx.fillRect(scaleX(pipe.x),0,scaleW(pipe.w),scaleY(pipe.top));
    ctx.fillRect(scaleX(pipe.x),canvas.height-scaleY(pipe.bottom),scaleW(pipe.w),scaleY(pipe.bottom));
  });

  ctx.fillStyle='white';
  ctx.font=`${24*canvas.width/BASE_WIDTH}px Arial`;
  ctx.fillText('得分: '+score,scaleX(10),scaleY(30));
}

// 循环
function loop(){
  if(gameOver){
    buttonsContainer.style.display='block';
    ctx.fillStyle='rgba(0,0,0,0.5)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='white';
    ctx.font=`${36*canvas.width/BASE_WIDTH}px Arial`;
    ctx.fillText('游戏结束',scaleX(100),scaleY(300));
    ctx.fillText('得分: '+score,scaleX(120),scaleY(350));
    return;
  }
  update();
  draw();
  requestAnimationFrame(loop);
}

// 按钮事件
restartBtn.addEventListener('click', resetGame);
homeBtn.addEventListener('click', ()=>{ window.location.href='index.html'; });

loop();
</script>
</body>
</html>